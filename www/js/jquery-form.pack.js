(function($){$.fn.ajaxSubmit=function(r){if(typeof r=='function')r={success:r};r=$.extend({url:this.attr('action')||window.location.toString(),type:this.attr('method')||'GET'},r||{});var u={};this.trigger('form-pre-serialize',[this,r,u]);if(u.veto)return this;var a=this.formToArray(r.semantic);if(r.data){r.extraData=r.data;for(var n in r.data)a.push({name:n,value:r.data[n]})}if(r.beforeSubmit&&r.beforeSubmit(a,this,r)===false)return this;this.trigger('form-submit-validate',[a,this,r,u]);if(u.veto)return this;var q=$.param(a);if(r.type.toUpperCase()=='GET'){r.url+=(r.url.indexOf('?')>=0?'&':'?')+q;r.data=null}else r.data=q;var v=this,callbacks=[];if(r.resetForm)callbacks.push(function(){v.resetForm()});if(r.clearForm)callbacks.push(function(){v.clearForm()});if(!r.dataType&&r.target){var w=r.success||function(){};callbacks.push(function(a){$(r.target).html(a).each(w,arguments)})}else if(r.success)callbacks.push(r.success);r.success=function(a,b){for(var i=0,max=callbacks.length;i<max;i++)callbacks[i](a,b,v)};var x=$('input:file',this).fieldValue();var y=false;for(var j=0;j<x.length;j++)if(x[j])y=true;if(r.iframe||y){if($.browser.safari&&r.closeKeepAlive)$.get(r.closeKeepAlive,fileUpload);else fileUpload()}else $.ajax(r);this.trigger('form-submit-notify',[this,r]);return this;function fileUpload(){var h=v[0];var i=$.extend({},$.ajaxSettings,r);var j='jqFormIO'+(new Date().getTime());var k=$('<iframe id="'+j+'" name="'+j+'" />');var l=k[0];var m=$.browser.opera&&window.opera.version()<9;if($.browser.msie||m)l.src='javascript:false;document.write("");';k.css({position:'absolute',top:'-1000px',left:'-1000px'});var o={responseText:null,responseXML:null,status:0,statusText:'n/a',getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){}};var g=i.global;if(g&&!$.active++)$.event.trigger("ajaxStart");if(g)$.event.trigger("ajaxSend",[o,i]);var p=0;var q=0;setTimeout(function(){var t=v.attr('target'),a=v.attr('action');v.attr({target:j,encoding:'multipart/form-data',enctype:'multipart/form-data',method:'POST',action:i.url});if(i.timeout)setTimeout(function(){q=true;cb()},i.timeout);var b=[];try{if(r.extraData)for(var n in r.extraData)b.push($('<input type="hidden" name="'+n+'" value="'+r.extraData[n]+'" />').appendTo(h)[0]);k.appendTo('body');l.attachEvent?l.attachEvent('onload',cb):l.addEventListener('load',cb,false);h.submit()}finally{v.attr('action',a);t?v.attr('target',t):v.removeAttr('target');$(b).remove()}},10);function cb(){if(p++)return;l.detachEvent?l.detachEvent('onload',cb):l.removeEventListener('load',cb,false);var c=true;try{if(q)throw'timeout';var d,doc;doc=l.contentWindow?l.contentWindow.document:l.contentDocument?l.contentDocument:l.document;o.responseText=doc.body?doc.body.innerHTML:null;o.responseXML=doc.XMLDocument?doc.XMLDocument:doc;o.getResponseHeader=function(a){var b={'content-type':i.dataType};return b[a]};if(i.dataType=='json'||i.dataType=='script'){var f=doc.getElementsByTagName('textarea')[0];o.responseText=f?f.value:o.responseText}else if(i.dataType=='xml'&&!o.responseXML&&o.responseText!=null){o.responseXML=toXml(o.responseText)}d=$.httpData(o,i.dataType)}catch(e){c=false;$.handleError(i,o,'error',e)}if(c){i.success(d,'success');if(g)$.event.trigger("ajaxSuccess",[o,i])}if(g)$.event.trigger("ajaxComplete",[o,i]);if(g&&!--$.active)$.event.trigger("ajaxStop");if(i.complete)i.complete(o,c?'success':'error');setTimeout(function(){k.remove();o.responseXML=null},100)};function toXml(s,a){if(window.ActiveXObject){a=new ActiveXObject('Microsoft.XMLDOM');a.async='false';a.loadXML(s)}else a=(new DOMParser()).parseFromString(s,'text/xml');return(a&&a.documentElement&&a.documentElement.tagName!='parsererror')?a:null}}};$.fn.ajaxForm=function(c){return this.ajaxFormUnbind().bind('submit.form-plugin',function(){$(this).ajaxSubmit(c);return false}).each(function(){$(":submit,input:image",this).bind('click.form-plugin',function(e){var a=this.form;a.clk=this;if(this.type=='image'){if(e.offsetX!=undefined){a.clk_x=e.offsetX;a.clk_y=e.offsetY}else if(typeof $.fn.offset=='function'){var b=$(this).offset();a.clk_x=e.pageX-b.left;a.clk_y=e.pageY-b.top}else{a.clk_x=e.pageX-this.offsetLeft;a.clk_y=e.pageY-this.offsetTop}}setTimeout(function(){a.clk=a.clk_x=a.clk_y=null},10)})})};$.fn.ajaxFormUnbind=function(){this.unbind('submit.form-plugin');return this.each(function(){$(":submit,input:image",this).unbind('click.form-plugin')})};$.fn.formToArray=function(b){var a=[];if(this.length==0)return a;var c=this[0];var d=b?c.getElementsByTagName('*'):c.elements;if(!d)return a;for(var i=0,max=d.length;i<max;i++){var e=d[i];var n=e.name;if(!n)continue;if(b&&c.clk&&e.type=="image"){if(!e.disabled&&c.clk==e)a.push({name:n+'.x',value:c.clk_x},{name:n+'.y',value:c.clk_y});continue}var v=$.fieldValue(e,true);if(v&&v.constructor==Array){for(var j=0,jmax=v.length;j<jmax;j++)a.push({name:n,value:v[j]})}else if(v!==null&&typeof v!='undefined')a.push({name:n,value:v})}if(!b&&c.clk){var f=c.getElementsByTagName("input");for(var i=0,max=f.length;i<max;i++){var g=f[i];var n=g.name;if(n&&!g.disabled&&g.type=="image"&&c.clk==g)a.push({name:n+'.x',value:c.clk_x},{name:n+'.y',value:c.clk_y})}}return a};$.fn.formSerialize=function(a){return $.param(this.formToArray(a))};$.fn.fieldSerialize=function(b){var a=[];this.each(function(){var n=this.name;if(!n)return;var v=$.fieldValue(this,b);if(v&&v.constructor==Array){for(var i=0,max=v.length;i<max;i++)a.push({name:n,value:v[i]})}else if(v!==null&&typeof v!='undefined')a.push({name:this.name,value:v})});return $.param(a)};$.fn.fieldValue=function(a){for(var b=[],i=0,max=this.length;i<max;i++){var c=this[i];var v=$.fieldValue(c,a);if(v===null||typeof v=='undefined'||(v.constructor==Array&&!v.length))continue;v.constructor==Array?$.merge(b,v):b.push(v)}return b};$.fieldValue=function(b,c){var n=b.name,t=b.type,tag=b.tagName.toLowerCase();if(typeof c=='undefined')c=true;if(c&&(!n||b.disabled||t=='reset'||t=='button'||(t=='checkbox'||t=='radio')&&!b.checked||(t=='submit'||t=='image')&&b.form&&b.form.clk!=b||tag=='select'&&b.selectedIndex==-1))return null;if(tag=='select'){var d=b.selectedIndex;if(d<0)return null;var a=[],ops=b.options;var e=(t=='select-one');var f=(e?d+1:ops.length);for(var i=(e?d:0);i<f;i++){var g=ops[i];if(g.selected){var v=$.browser.msie&&!(g.attributes['value'].specified)?g.text:g.value;if(e)return v;a.push(v)}}return a}return b.value};$.fn.clearForm=function(){return this.each(function(){$('input,select,textarea',this).clearFields()})};$.fn.clearFields=$.fn.clearInputs=function(){return this.each(function(){var t=this.type,tag=this.tagName.toLowerCase();if(t=='text'||t=='password'||tag=='textarea')this.value='';else if(t=='checkbox'||t=='radio')this.checked=false;else if(tag=='select')this.selectedIndex=-1})};$.fn.resetForm=function(){return this.each(function(){if(typeof this.reset=='function'||(typeof this.reset=='object'&&!this.reset.nodeType))this.reset()})};$.fn.enable=function(b){if(b==undefined)b=true;return this.each(function(){this.disabled=!b})};$.fn.select=function(b){if(b==undefined)b=true;return this.each(function(){var t=this.type;if(t=='checkbox'||t=='radio')this.checked=b;else if(this.tagName.toLowerCase()=='option'){var a=$(this).parent('select');if(b&&a[0]&&a[0].type=='select-one'){a.find('option').select(false)}this.selected=b}})}})(jQuery);
